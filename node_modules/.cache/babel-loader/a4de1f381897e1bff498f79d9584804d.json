{"ast":null,"code":"'use strict';\n\nvar fromParse5 = require('hast-util-from-parse5');\n\nvar Parser5 = require('parse5/lib/parser');\n\nvar xtend = require('xtend');\n\nvar errors = require('./errors.json');\n\nvar base = 'https://html.spec.whatwg.org/multipage/parsing.html#parse-error-';\nvar fatalities = {\n  2: true,\n  1: false,\n  0: null\n};\nmodule.exports = parse;\n\nfunction parse(options) {\n  var settings = xtend(options, this.data('settings'));\n  var position = settings.position;\n  position = typeof position === 'boolean' ? position : true;\n  this.Parser = parser;\n\n  function parser(doc, file) {\n    var fn = settings.fragment ? 'parseFragment' : 'parse';\n    var onParseError = settings.emitParseErrors ? onerror : null;\n    var parse5 = new Parser5({\n      sourceCodeLocationInfo: position,\n      onParseError: onParseError,\n      scriptingEnabled: false\n    });\n    return fromParse5(parse5[fn](doc), {\n      space: settings.space,\n      file: file,\n      verbose: settings.verbose\n    });\n\n    function onerror(err) {\n      var code = err.code;\n      var name = camelcase(code);\n      var setting = settings[name];\n      var config = setting === undefined || setting === null ? true : setting;\n      var level = typeof config === 'number' ? config : config ? 1 : 0;\n      var start = {\n        line: err.startLine,\n        column: err.startCol,\n        offset: err.startOffset\n      };\n      var end = {\n        line: err.endLine,\n        column: err.endCol,\n        offset: err.endOffset\n      };\n      var info;\n      var message;\n\n      if (level) {\n        info = errors[name] ||\n        /* istanbul ignore next */\n        {\n          reason: '',\n          description: ''\n        };\n        message = file.message(format(info.reason), {\n          start: start,\n          end: end\n        });\n        message.source = 'parse-error';\n        message.ruleId = code;\n        message.fatal = fatalities[level];\n        message.note = format(info.description);\n        message.url = info.url === false ? null : base + code;\n      }\n\n      function format(value) {\n        return value.replace(/%c(?:-(\\d+))?/g, char).replace(/%x/g, encodedChar);\n      }\n\n      function char($0, $1) {\n        var offset = $1 ? -parseInt($1, 10) : 0;\n        var char = doc.charAt(err.startOffset + offset);\n        return char === '`' ? '` ` `' : char;\n      }\n\n      function encodedChar() {\n        var char = doc.charCodeAt(err.startOffset).toString(16).toUpperCase();\n        return '0x' + char;\n      }\n    }\n  }\n}\n\nfunction camelcase(value) {\n  return value.replace(/-[a-z]/g, replacer);\n}\n\nfunction replacer($0) {\n  return $0.charAt(1).toUpperCase();\n}","map":null,"metadata":{},"sourceType":"script"}